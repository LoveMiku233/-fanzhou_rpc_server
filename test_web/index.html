<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>泛舟RPC服务器调试工具</title>
    <!-- ========================================================
         泛舟RPC服务器调试工具
         
         功能说明：
         1. 通过WebSocket连接到RPC服务器（需要websocket代理）
         2. 提供快捷操作按钮用于常用RPC方法
         3. 支持继电器控制和分组管理
         4. 提供设备列表和分组列表的可视化显示
         5. 左右布局：导航在左侧，内容在右侧
         6. 动态背景动画效果
         
         使用方法：
         1. 在设备上启动websocat代理：
            websocat --text ws-l:0.0.0.0:12346 tcp:127.0.0.1:12345
         2. 在浏览器中打开此页面
         3. 输入设备IP地址和WebSocket端口，点击连接
         
         RPC说明：
         - relay.control: 控制单个节点的单个通道
         - group.control: 控制分组中所有节点的指定通道
         ======================================================== -->
    <!-- 引入外部样式表 -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/blueprint.css">
</head>
<body>
    <!-- ==================== 动态背景动画 ==================== -->
    <div class="animated-background"></div>
    <div class="floating-shapes">
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
    </div>

    <!-- ==================== 页面头部 ==================== -->
    <div class="header">
        <h1>🚀 泛舟RPC服务器调试工具</h1>
        <div class="header-status">
            <span class="status-badge disconnected" id="headerConnectionStatus">
                <span class="status-dot"></span>
                <span>未连接</span>
            </span>
        </div>
    </div>

    <!-- ==================== 主布局容器 - 左右布局 ==================== -->
    <div class="main-layout">
        <!-- ==================== 左侧导航栏 ==================== -->
        <div class="sidebar">
            <div class="sidebar-nav">
                <button class="nav-btn" onclick="showPage('connection')" data-page="connection">
                    📡 连接
                </button>
                <button class="nav-btn active" onclick="showPage('quick')" data-page="quick">
                    🏠 主页
                </button>
                <button class="nav-btn" onclick="showPage('devices')" data-page="devices">
                    🔌 设备
                </button>
                <button class="nav-btn" onclick="showPage('groups')" data-page="groups">
                    📂 分组
                </button>
                <button class="nav-btn" onclick="showPage('strategy')" data-page="strategy">
                    ⏱️ 策略
                </button>
                <button class="nav-btn" onclick="showPage('blueprint')" data-page="blueprint">
                    🎨 蓝图
                </button>
                <button class="nav-btn" onclick="showPage('custom')" data-page="custom">
                    🛠️ 高级
                </button>
            </div>
        </div>

        <!-- ==================== 右侧内容区 ==================== -->
        <div class="content-area">
            <div class="card">

            <!-- ==================== 连接设置页面 ==================== -->
            <div class="page-content" id="page-connection">
                <h3 style="margin-bottom: 20px; color: #333;">📡 连接设置</h3>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <div class="form-row">
                        <!-- 服务器地址输入 -->
                        <div class="form-group">
                            <label>服务器地址</label>
                            <input type="text" id="serverHost" placeholder="例如: 192.168.1.100" value="localhost">
                        </div>
                        <!-- WebSocket端口输入 -->
                        <div class="form-group">
                            <label>WebSocket端口</label>
                            <input type="number" id="serverPort" placeholder="端口" value="12346">
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 20px; margin-top: 20px; flex-wrap: wrap;">
                        <!-- 连接/断开按钮 -->
                        <button id="connectBtn" onclick="toggleConnection()" style="min-width: 150px;">🔌 连接</button>
                        <!-- 连接状态显示 -->
                        <span class="status-badge disconnected" id="connectionStatus">
                            <span class="status-dot"></span>
                            <span>未连接</span>
                        </span>
                    </div>
                </div>
                
                <!-- 连接说明 -->
                <div class="help-section">
                    <h4>📋 连接说明</h4>
                    <p style="margin-bottom: 10px; color: #666;">由于浏览器安全限制，需要在设备上运行WebSocket代理。请执行以下命令：</p>
                    <pre>
# 安装websocat（如果尚未安装）
# 下载地址: https://github.com/vi/websocat/releases

# 启动WebSocket到TCP的代理（文本模式）
websocat --text ws-l:0.0.0.0:12346 tcp:127.0.0.1:12345</pre>
                </div>
                
                <!-- 快速提示 -->
                <div style="background: #e3f2fd; padding: 15px 20px; border-radius: 12px; margin-top: 20px; border-left: 4px solid #2196f3;">
                    <strong style="color: #1565c0;">💡 提示</strong>
                    <p style="color: #666; font-size: 13px; margin-top: 5px;">连接成功后，请切换到"主页"标签页开始使用各项功能。</p>
                </div>
            </div>

            <!-- ==================== 快捷操作页面 ==================== -->
            <div class="page-content active" id="page-quick">
                <h3 style="margin-bottom: 20px; color: #333;">常用RPC方法快捷按钮</h3>
                
                <!-- 急停按钮区域 - 最醒目的红色大按钮 -->
                <div style="margin-bottom: 25px;">
                    <button id="emergencyStopBtn" onclick="emergencyStop()" style="
                        width: 100%;
                        padding: 20px;
                        font-size: 24px;
                        font-weight: bold;
                        color: white;
                        background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
                        border: 3px solid #922b21;
                        border-radius: 12px;
                        cursor: pointer;
                        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 6px 20px rgba(231, 76, 60, 0.6)';"
                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(231, 76, 60, 0.4)';">
                        🛑 急 停
                    </button>
                    <p style="text-align: center; color: #e74c3c; font-size: 12px; margin-top: 8px;">
                        点击立即停止所有设备的所有通道
                    </p>
                </div>

                <!-- 快速状态卡片 -->
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white;">
                        <div style="font-size: 24px; margin-bottom: 8px;">🔌</div>
                        <div style="font-size: 13px; opacity: 0.9;">设备管理</div>
                        <button onclick="showPage('devices'); refreshDeviceList()" style="margin-top: 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); width: 100%;">打开</button>
                    </div>
                    <div style="background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%); padding: 20px; border-radius: 12px; color: white;">
                        <div style="font-size: 24px; margin-bottom: 8px;">📂</div>
                        <div style="font-size: 13px; opacity: 0.9;">分组控制</div>
                        <button onclick="showPage('groups'); refreshGroupList()" style="margin-top: 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); width: 100%;">打开</button>
                    </div>
                    <div style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); padding: 20px; border-radius: 12px; color: white;">
                        <div style="font-size: 24px; margin-bottom: 8px;">⏱️</div>
                        <div style="font-size: 13px; opacity: 0.9;">自动策略</div>
                        <button onclick="showPage('strategy'); refreshStrategyList()" style="margin-top: 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); width: 100%;">打开</button>
                    </div>
                    <div style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); padding: 20px; border-radius: 12px; color: white;">
                        <div style="font-size: 24px; margin-bottom: 8px;">🎨</div>
                        <div style="font-size: 13px; opacity: 0.9;">可视化蓝图</div>
                        <button onclick="showPage('blueprint')" style="margin-top: 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); width: 100%;">打开</button>
                    </div>
                </div>

                <!-- 配置保存提示 -->
                <div style="background: #e8f5e9; padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div>
                            <strong style="color: #2e7d32;">💡 修改后别忘了保存配置！</strong>
                            <span style="color: #666; font-size: 13px; margin-left: 10px;">否则重启后会丢失</span>
                        </div>
                        <button class="success" onclick="saveConfig()" style="min-width: 120px;">💾 保存配置</button>
                    </div>
                </div>
                
                <!-- 快捷操作按钮 -->
                <h4 style="margin-bottom: 15px; color: #333;">🚀 快捷操作</h4>
                <div class="quick-actions-grid">
                    <button class="quick-action-btn" onclick="callMethod('rpc.ping', {})">
                        <span class="icon">🔔</span>
                        Ping测试
                    </button>
                    <button class="quick-action-btn" onclick="callMethod('sys.info', {})">
                        <span class="icon">ℹ️</span>
                        系统信息
                    </button>
                    <button class="quick-action-btn warning" onclick="checkCanStatus()">
                        <span class="icon">🔧</span>
                        CAN诊断
                    </button>
                    <button class="quick-action-btn success" onclick="callMethod('relay.queryAll', {})">
                        <span class="icon">🔍</span>
                        查询全部设备
                    </button>
                </div>
            </div>

            <!-- ==================== 设备列表页面 ==================== -->
            <!-- 
                设备列表页面说明：
                - 显示所有已配置的CAN继电器设备
                - 每个设备以卡片形式展示，包含状态和控制按钮
                - 支持单通道控制和全部通道控制
                - 设备在线状态由服务端根据最后响应时间判断（30秒内有响应认为在线）
            -->
            <div class="page-content" id="page-devices">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333;">🔌 设备列表</h3>
                    <div class="btn-group">
                        <button onclick="refreshDeviceList()">🔄 刷新列表</button>
                        <button class="secondary" onclick="readDeviceConfig()">📋 读取配置</button>
                        <button class="warning" onclick="checkCanStatus()">🔧 CAN诊断</button>
                    </div>
                </div>
                
                <!-- CAN状态警告提示（当CAN未打开时显示） -->
                <div id="canWarningPanel" style="display: none; background: #fff3e0; padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
                    <h4 style="margin-bottom: 10px; color: #e65100;">⚠️ CAN总线未打开</h4>
                    <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                        控制命令无法发送！CAN总线未正确连接或配置。
                    </p>
                    <div class="btn-group">
                        <button class="warning" onclick="checkCanStatus()">🔧 查看诊断信息</button>
                    </div>
                </div>
                
                <!-- 设备配置显示区域 -->
                <div id="deviceConfigPanel" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; color: #333;">📋 设备配置信息</h4>
                    <pre id="deviceConfigContent" style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 13px;"></pre>
                </div>
                
                <!-- 设备卡片网格视图 - 整合了列表和卡片功能 -->
                <!-- 每个卡片既显示设备状态，也提供控制按钮 -->
                <div id="deviceListEmpty" class="data-list-empty" style="display: none; background: #f8f9fa; border-radius: 12px; padding: 40px 20px;">
                    <p>📭 暂无设备数据</p>
                    <p style="font-size: 12px; margin-top: 10px;">请先连接服务器并点击"刷新列表"</p>
                </div>
                <div class="device-cards" id="deviceCards">
                    <!-- 设备卡片将由JavaScript动态生成 -->
                </div>
            </div>

            <!-- ==================== 分组管理页面 ==================== -->
            <div class="page-content" id="page-groups">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333;">📂 分组管理</h3>
                    <div class="btn-group">
                        <button onclick="refreshGroupList()">🔄 刷新</button>
                    </div>
                </div>
                
                <!-- 操作按钮区 - 表格上方 -->
                <div class="action-toolbar" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px;">
                    <button class="success" onclick="openCreateGroupModal()" style="min-width: 120px;">
                        ➕ 创建分组
                    </button>
                    <button class="secondary" onclick="openManageChannelModal()" style="min-width: 140px;">
                        🔧 管理设备通道
                    </button>
                    <button class="warning" onclick="batchControlGroups('stop')" style="min-width: 100px;">
                        ⏹️ 全部停止
                    </button>
                    <button class="success" onclick="batchControlGroups('fwd')" style="min-width: 100px;">
                        ▶️ 全部正转
                    </button>
                    <button onclick="batchControlGroups('rev')" style="min-width: 100px;">
                        ◀️ 全部反转
                    </button>
                </div>

                <!-- 分组卡片视图 -->
                <div id="groupCardsEmpty" class="data-list-empty" style="display: none; background: #f8f9fa; border-radius: 12px; padding: 40px 20px;">
                    <p>📭 暂无分组数据</p>
                    <p style="font-size: 12px; margin-top: 10px;">请先连接服务器并点击"刷新"按钮</p>
                </div>
                <div class="group-cards" id="groupCards">
                    <!-- 分组卡片将由JavaScript动态生成 -->
                </div>
            </div>

            <!-- ==================== 策略管理页面 ==================== -->
            <div class="page-content" id="page-strategy">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333;">⏱️ 策略管理</h3>
                    <div class="btn-group">
                        <button onclick="refreshStrategyList()">🔄 刷新</button>
                        <button class="secondary" onclick="showPage('blueprint')">🎨 可视化编辑器</button>
                    </div>
                </div>

                <!-- 快速创建卡片区 - 新手友好的一键创建 -->
                <div style="margin-bottom: 25px;">
                    <h4 style="color: #555; margin-bottom: 12px; font-size: 14px;">🚀 快速创建 <span style="color: #999; font-weight: normal; font-size: 12px;">（选择场景，一键添加策略）</span></h4>
                    <div class="quick-strategy-cards" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                        <!-- 定时通风模板 -->
                        <div class="quick-strategy-card" onclick="createQuickStrategy('ventilation')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; color: white; cursor: pointer; transition: all 0.3s;">
                            <div style="font-size: 28px; margin-bottom: 10px;">🌬️</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">定时通风</div>
                            <div style="font-size: 12px; opacity: 0.9;">每小时运行5分钟</div>
                        </div>
                        <!-- 定时浇水模板 -->
                        <div class="quick-strategy-card" onclick="createQuickStrategy('irrigation')" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 12px; padding: 20px; color: white; cursor: pointer; transition: all 0.3s;">
                            <div style="font-size: 28px; margin-bottom: 10px;">💧</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">定时浇水</div>
                            <div style="font-size: 12px; opacity: 0.9;">每天早上8点执行</div>
                        </div>
                        <!-- 高温报警模板 -->
                        <div class="quick-strategy-card" onclick="createQuickStrategy('hightemp')" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); border-radius: 12px; padding: 20px; color: white; cursor: pointer; transition: all 0.3s;">
                            <div style="font-size: 28px; margin-bottom: 10px;">🌡️</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">高温自动降温</div>
                            <div style="font-size: 12px; opacity: 0.9;">温度>30°C时启动风扇</div>
                        </div>
                        <!-- 低温保护模板 -->
                        <div class="quick-strategy-card" onclick="createQuickStrategy('lowtemp')" style="background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%); border-radius: 12px; padding: 20px; color: white; cursor: pointer; transition: all 0.3s;">
                            <div style="font-size: 28px; margin-bottom: 10px;">❄️</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">低温自动保暖</div>
                            <div style="font-size: 12px; opacity: 0.9;">温度&lt;10°C时启动加热</div>
                        </div>
                        <!-- 自定义策略 -->
                        <div class="quick-strategy-card" onclick="openSimpleStrategyWizard()" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%); border-radius: 12px; padding: 20px; color: white; cursor: pointer; transition: all 0.3s; border: 2px dashed rgba(255,255,255,0.5);">
                            <div style="font-size: 28px; margin-bottom: 10px;">➕</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">自定义策略</div>
                            <div style="font-size: 12px; opacity: 0.9;">按需配置参数</div>
                        </div>
                    </div>
                </div>

                <!-- 使用提示 -->
                <div style="background: #e8f5e9; padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">💡</span>
                        <div>
                            <strong style="color: #2e7d32;">新手提示</strong>
                            <span style="color: #666; font-size: 13px; margin-left: 10px;">点击上方卡片可快速创建常用策略，或使用下方按钮自定义创建</span>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮区 - 高级选项 -->
                <details style="margin-bottom: 20px;">
                    <summary style="cursor: pointer; padding: 12px 15px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 12px; font-weight: 600; color: #1565c0;">
                        🛠️ 高级选项（展开查看更多创建方式）
                    </summary>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; padding: 15px; background: #f5f5f5; border-radius: 0 0 12px 12px; margin-top: -5px;">
                        <button class="success" onclick="openCreateStrategyModal()" style="min-width: 140px;">
                            ⏱️ 创建定时策略
                        </button>
                        <button class="warning" onclick="openCreateSensorStrategyModal()" style="min-width: 140px;">
                            📡 创建传感器策略
                        </button>
                        <button class="secondary" onclick="showPage('blueprint')" style="min-width: 120px;">
                            🎨 蓝图编辑器
                        </button>
                    </div>
                </details>

                <!-- 策略卡片视图 -->
                <h4 style="color: #555; margin-bottom: 12px; font-size: 14px;">⏱️ 定时策略</h4>
                <div id="strategyCardsEmpty" class="data-list-empty" style="display: none; background: #f8f9fa; border-radius: 12px; padding: 40px 20px;">
                    <p>📭 暂无定时策略</p>
                    <p style="font-size: 12px; margin-top: 10px;">点击上方的快速创建卡片添加策略</p>
                </div>
                <div class="strategy-cards" id="strategyCards">
                    <!-- 策略卡片将由JavaScript动态生成 -->
                </div>

                <!-- 传感器策略卡片视图 -->
                <h4 style="color: #555; margin: 25px 0 12px 0; font-size: 14px;">📡 传感器策略</h4>
                <div id="sensorStrategyCardsEmpty" class="data-list-empty" style="display: none; background: #f8f9fa; border-radius: 12px; padding: 40px 20px;">
                    <p>📭 暂无传感器策略</p>
                    <p style="font-size: 12px; margin-top: 10px;">点击上方的快速创建卡片添加传感器策略</p>
                </div>
                <div class="strategy-cards" id="sensorStrategyCards">
                    <!-- 传感器策略卡片将由JavaScript动态生成 -->
                </div>
            </div>

            <!-- ==================== 高级功能页面（合并继电器控制、自定义调用、帮助） ==================== -->
            <div class="page-content" id="page-custom">
                <h3 style="margin-bottom: 20px; color: #333;">🛠️ 高级功能</h3>
                
                <!-- 继电器直接控制 -->
                <details open style="background: #f5f5f5; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <summary style="cursor: pointer; font-weight: 600; color: #333;">🎛️ 继电器直接控制</summary>
                    <div class="form-row" style="margin-top: 15px;">
                        <div class="form-group">
                            <label>节点ID</label>
                            <input type="number" id="relayNode" value="1" min="1" max="255">
                        </div>
                        <div class="form-group">
                            <label>通道</label>
                            <select id="relayChannel">
                                <option value="0">CH0</option>
                                <option value="1">CH1</option>
                                <option value="2">CH2</option>
                                <option value="3">CH3</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>动作</label>
                            <select id="relayAction">
                                <option value="stop">⏹️ 停止</option>
                                <option value="fwd">▶️ 正转</option>
                                <option value="rev">◀️ 反转</option>
                            </select>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="success" onclick="controlRelay()">⚡ 执行</button>
                        <button onclick="queryRelay()">🔍 查询</button>
                        <button onclick="queryRelayAll()">📊 全部</button>
                    </div>
                    
                    <!-- 分组控制 -->
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong style="display: block; margin-bottom: 10px;">📦 分组控制</strong>
                        <div class="form-row">
                            <div class="form-group">
                                <label>分组ID</label>
                                <input type="number" id="groupControlId" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label>通道</label>
                                <select id="groupControlChannel">
                                    <option value="0">CH0</option>
                                    <option value="1">CH1</option>
                                    <option value="2">CH2</option>
                                    <option value="3">CH3</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>动作</label>
                                <select id="groupControlAction">
                                    <option value="stop">⏹️ 停止</option>
                                    <option value="fwd">▶️ 正转</option>
                                    <option value="rev">◀️ 反转</option>
                                </select>
                            </div>
                        </div>
                        <button class="success" onclick="controlGroup()">⚡ 执行分组控制</button>
                    </div>
                </details>

                <!-- 自定义RPC调用 -->
                <details style="background: #e3f2fd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <summary style="cursor: pointer; font-weight: 600; color: #333;">🛠️ 自定义RPC调用</summary>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>方法名</label>
                        <input type="text" id="methodName" placeholder="例如: rpc.ping, relay.control">
                    </div>
                    <div class="form-group">
                        <label>参数 (JSON格式)</label>
                        <textarea id="methodParams" placeholder='例如: {"node": 1, "ch": 0, "action": "fwd"}'>{}</textarea>
                    </div>
                    <button onclick="callCustomMethod()">🚀 发送请求</button>
                </details>

                <!-- 配置管理 -->
                <details style="background: #fff3e0; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <summary style="cursor: pointer; font-weight: 600; color: #333;">💾 配置管理</summary>
                    <p style="color: #666; font-size: 13px; margin: 15px 0;">
                        通过Web页面创建的修改默认只保存在内存中，重启后会丢失。
                    </p>
                    <div class="btn-group">
                        <button class="success" onclick="saveConfig()">💾 保存配置</button>
                        <button onclick="getConfig()">📋 查看配置</button>
                        <button class="warning" onclick="reloadConfig()">🔄 重载配置</button>
                    </div>
                </details>

                <!-- 常用RPC方法参考 -->
                <details style="background: #f5f5f5; padding: 20px; border-radius: 12px;">
                    <summary style="cursor: pointer; font-weight: 600; color: #333;">📚 常用RPC方法参考</summary>
                    <ul style="margin-top: 15px; color: #666; font-size: 13px; line-height: 1.8;">
                        <li><code>rpc.ping</code> - 测试连接</li>
                        <li><code>sys.info</code> - 系统信息</li>
                        <li><code>can.status</code> - CAN总线状态</li>
                        <li><code>relay.control</code> - 控制继电器 <code>{"node": 1, "ch": 0, "action": "fwd"}</code></li>
                        <li><code>relay.statusAll</code> - 查询设备状态 <code>{"node": 1}</code></li>
                        <li><code>group.list</code> - 分组列表</li>
                        <li><code>group.control</code> - 分组控制 <code>{"groupId": 1, "ch": 0, "action": "stop"}</code></li>
                        <li><code>auto.strategy.list</code> - 策略列表</li>
                        <li><code>config.save</code> - 保存配置</li>
                    </ul>
                </details>
            </div>

            <!-- ==================== 蓝图编辑器页面 ==================== -->
            <div class="page-content" id="page-blueprint">
                <h3 style="margin-bottom: 15px; color: #333;">🎨 可视化蓝图编辑器</h3>
                <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                    通过拖放方式创建自动化策略。将左侧的触发器和动作节点拖到画布上，然后连接它们来创建策略流程。
                </p>
                
                <!-- 蓝图编辑器主容器 -->
                <div class="blueprint-editor">
                    <!-- 左侧节点面板 -->
                    <div class="node-palette">
                        <div class="palette-title">📦 节点工具箱</div>
                        
                        <!-- 触发器类型 -->
                        <div class="palette-category">
                            <div class="palette-category-title">🔔 触发器</div>
                            <div class="palette-item" draggable="true" data-node-type="trigger-time">
                                <span class="item-icon">⏰</span>
                                <span class="item-name">定时触发器</span>
                            </div>
                            <div class="palette-item" draggable="true" data-node-type="trigger-sensor">
                                <span class="item-icon">📡</span>
                                <span class="item-name">传感器触发</span>
                            </div>
                        </div>
                        
                        <!-- 动作类型 -->
                        <div class="palette-category">
                            <div class="palette-category-title">⚡ 动作</div>
                            <div class="palette-item" draggable="true" data-node-type="action-relay">
                                <span class="item-icon">🎛️</span>
                                <span class="item-name">继电器控制</span>
                            </div>
                            <div class="palette-item" draggable="true" data-node-type="action-group">
                                <span class="item-icon">📦</span>
                                <span class="item-name">分组控制</span>
                            </div>
                        </div>
                        
                        <!-- 显示类型 -->
                        <div class="palette-category">
                            <div class="palette-category-title">📊 展示</div>
                            <div class="palette-item" draggable="true" data-node-type="device">
                                <span class="item-icon">🔌</span>
                                <span class="item-name">设备节点</span>
                            </div>
                            <div class="palette-item" draggable="true" data-node-type="group">
                                <span class="item-icon">📂</span>
                                <span class="item-name">分组节点</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 中间画布区域 -->
                    <div class="blueprint-canvas-container">
                        <!-- 工具栏 -->
                        <div class="canvas-toolbar">
                            <button onclick="clearBlueprint()" title="删除所有节点和连线">🗑️ 清空画布</button>
                            <button class="success" onclick="deployBlueprintStrategies()" title="将蓝图转换为实际的RPC策略">🚀 部署策略</button>
                            <button class="warning" onclick="loadExistingStrategies()" title="从服务器读取已有的策略并显示在画布上">📋 读取策略</button>
                            <button class="secondary" onclick="generateSystemDiagram()" title="从服务器读取设备和分组信息">📊 生成系统框图</button>
                            <button onclick="downloadBlueprint()" title="将蓝图保存为JSON文件">💾 导出蓝图</button>
                            <button onclick="uploadBlueprint()" title="从JSON文件导入蓝图">📂 导入蓝图</button>
                        </div>
                        
                        <!-- 蓝图画布 -->
                        <div class="blueprint-canvas" id="blueprintCanvas">
                            <!-- 空状态提示 -->
                            <div class="canvas-empty-hint" id="canvasEmptyHint">
                                <div class="hint-icon">🎨</div>
                                <div class="hint-text">
                                    从左侧拖放节点到此处<br>
                                    创建您的自动化策略
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 右侧属性面板 -->
                    <div class="node-properties-panel" id="nodePropertiesPanel">
                        <div class="properties-header">
                            <span class="prop-icon">⚙️</span>
                            <span class="prop-title">节点属性</span>
                        </div>
                        <div class="properties-content">
                            <p class="prop-description">选择一个节点查看和编辑其属性</p>
                        </div>
                    </div>
                </div>
                
                <!-- 简化使用说明 -->
                <details style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <summary style="cursor: pointer; font-weight: 600; color: #666;">📖 使用说明（点击展开）</summary>
                    <ul style="margin-top: 10px; color: #666; font-size: 13px; line-height: 1.8;">
                        <li><strong>添加节点：</strong>从左侧工具箱拖放到画布</li>
                        <li><strong>连接：</strong>拖动输出端口（橙色）到输入端口（绿色）</li>
                        <li><strong>配置：</strong>点击节点在右侧面板编辑属性</li>
                        <li><strong>部署：</strong>点击"部署策略"将蓝图转换为实际策略</li>
                        <li><strong>读取：</strong>点击"读取策略"从服务器加载现有策略</li>
                    </ul>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                        <strong style="color: #333;">⌨️ 键盘快捷键：</strong>
                        <span style="margin-left: 10px;">Delete=删除 | Ctrl+D=复制 | Shift+拖拽=精确定位 | Esc=取消选择</span>
                    </div>
                </details>
            </div>

            </div><!-- 结束 .card -->
        </div><!-- 结束 .content-area -->

        <!-- ==================== 右侧通信日志面板 ==================== -->
        <div class="log-sidebar">
            <div class="card log-card">
                <h2>📝 通信日志</h2>
                <div style="margin-bottom: 15px;">
                    <button class="secondary" onclick="clearLog()">🗑️ 清空日志</button>
                </div>
                <div class="log-container" id="logContainer">
                    <div class="log-placeholder">等待操作...</div>
                </div>
            </div>
        </div><!-- 结束 .log-sidebar -->
    </div><!-- 结束 .main-layout -->

    <!-- ==================== 弹窗组件 ==================== -->
    
    <!-- 创建分组弹窗 -->
    <div class="modal-overlay" id="groupModal" onclick="closeModalOnBackground(event, 'groupModal')">
        <div class="modal-content">
            <div class="modal-header">
                <h3>➕ 创建新分组</h3>
                <button class="modal-close" onclick="closeModal('groupModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>分组ID</label>
                    <input type="number" id="newGroupId" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>分组名称（可留空自动生成）</label>
                    <input type="text" id="newGroupName" placeholder="例如: main-group">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="closeModal('groupModal')">取消</button>
                <button class="success" onclick="createGroup()">➕ 创建分组</button>
            </div>
        </div>
    </div>

    <!-- 管理设备弹窗 -->
    <div class="modal-overlay" id="manageDeviceModal" onclick="closeModalOnBackground(event, 'manageDeviceModal')">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔗 管理分组设备</h3>
                <button class="modal-close" onclick="closeModal('manageDeviceModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>分组ID</label>
                        <input type="number" id="addDeviceGroupId" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>设备节点ID</label>
                        <input type="number" id="addDeviceNodeId" value="1" min="1" max="255">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="closeModal('manageDeviceModal')">关闭</button>
                <button class="danger" onclick="removeDeviceFromGroup()">➖ 移除设备</button>
                <button class="success" onclick="addDeviceToGroup()">➕ 添加设备</button>
            </div>
        </div>
    </div>

    <!-- 管理设备通道弹窗 - 新增，支持按通道绑定 -->
    <div class="modal-overlay" id="manageChannelModal" onclick="closeModalOnBackground(event, 'manageChannelModal')">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);">
                <h3>🔧 管理设备通道</h3>
                <button class="modal-close" onclick="closeModal('manageChannelModal')">✕</button>
            </div>
            <div class="modal-body">
                <div style="background: #e3f2fd; padding: 12px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 13px; color: #1565c0;">
                    💡 <strong>提示：</strong>可以将设备的单个通道添加到分组，同一设备的不同通道可以绑定到不同分组。
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>分组ID</label>
                        <input type="number" id="channelGroupId" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>设备节点ID</label>
                        <input type="number" id="channelNodeId" value="1" min="1" max="255">
                    </div>
                    <div class="form-group">
                        <label>通道</label>
                        <select id="channelNumber">
                            <option value="0">通道 0</option>
                            <option value="1">通道 1</option>
                            <option value="2">通道 2</option>
                            <option value="3">通道 3</option>
                        </select>
                    </div>
                </div>
                <div id="channelListDisplay" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; display: none;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">当前分组的通道列表：</div>
                    <div id="channelListContent" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="closeModal('manageChannelModal')">关闭</button>
                <button onclick="viewGroupChannels()">📋 查看通道</button>
                <button class="danger" onclick="removeChannelFromGroup()">➖ 移除通道</button>
                <button class="success" onclick="addChannelToGroup()">➕ 添加通道</button>
            </div>
        </div>
    </div>

    <!-- 创建定时策略弹窗 - 优化版 -->
    <div class="modal-overlay" id="strategyModal" onclick="closeModalOnBackground(event, 'strategyModal')">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>⏱️ 创建定时策略</h3>
                <button class="modal-close" onclick="closeModal('strategyModal')">✕</button>
            </div>
            <div class="modal-body">
                <!-- 提示信息 -->
                <div style="background: #e3f2fd; padding: 12px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 13px; color: #1565c0;">
                    💡 <strong>提示：</strong>定时策略会按照设定的时间间隔自动执行指定动作。策略会控制分组中绑定的所有通道。请先在分组中配置需要控制的通道。
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>策略ID <span style="color: #999; font-size: 11px;">（自动生成）</span></label>
                        <input type="number" id="newStrategyId" value="1" min="1" readonly style="background: #f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>策略名称 <span style="color: #999; font-size: 11px;">（可选）</span></label>
                        <input type="text" id="newStrategyName" placeholder="留空自动生成">
                    </div>
                    <div class="form-group">
                        <label>绑定分组ID <span style="color: #c62828; font-size: 11px;">*必填</span></label>
                        <input type="number" id="newStrategyGroupId" value="1" min="1">
                        <div style="font-size: 11px; color: #666; margin-top: 4px;">策略将控制该分组绑定的所有通道</div>
                    </div>
                </div>
                <!-- 隐藏的通道字段，默认值为-1（使用分组绑定的通道） -->
                <input type="hidden" id="newStrategyChannel" value="-1">
                <div class="form-row">
                    <div class="form-group">
                        <label>执行动作</label>
                        <select id="newStrategyAction">
                            <option value="fwd">▶️ 正转（启动）</option>
                            <option value="stop">⏹️ 停止</option>
                            <option value="rev">◀️ 反转</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>自动启动</label>
                        <select id="newStrategyAutoStart">
                            <option value="true">✅ 是</option>
                            <option value="false">❌ 否</option>
                        </select>
                    </div>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>触发方式</label>
                            <select id="newStrategyTriggerType" onchange="toggleTimerTypeInputs()">
                                <option value="interval">⏱️ 间隔执行</option>
                                <option value="daily">📅 每日定时</option>
                            </select>
                        </div>
                        <div class="form-group" id="intervalInputGroup">
                            <label>执行间隔（秒）</label>
                            <input type="number" id="newStrategyInterval" value="3600" min="1">
                            <div style="font-size: 11px; color: #666; margin-top: 4px;">常用：60=1分钟, 3600=1小时, 86400=1天</div>
                        </div>
                        <div class="form-group" id="dailyTimeInputGroup" style="display: none;">
                            <label>每日执行时间</label>
                            <input type="time" id="newStrategyDailyTime" value="08:00">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="closeModal('strategyModal')">取消</button>
                <button class="success" onclick="createTimerStrategyAndClose()">➕ 创建策略</button>
            </div>
        </div>
    </div>

    <!-- 创建传感器策略弹窗 - 优化版 -->
    <div class="modal-overlay" id="sensorStrategyModal" onclick="closeModalOnBackground(event, 'sensorStrategyModal')">
        <div class="modal-content modal-large">
            <div class="modal-header" style="background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);">
                <h3>📡 创建传感器策略</h3>
                <button class="modal-close" onclick="closeModal('sensorStrategyModal')">✕</button>
            </div>
            <div class="modal-body">
                <!-- 提示信息 -->
                <div style="background: #fff3e0; padding: 12px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 13px; color: #e65100;">
                    💡 <strong>提示：</strong>传感器策略会在传感器数值满足条件时自动执行。策略会控制分组中绑定的所有通道。请先在分组中配置需要控制的通道。
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>策略ID <span style="color: #999; font-size: 11px;">（自动生成）</span></label>
                        <input type="number" id="sensorStrategyId" value="1" min="1" readonly style="background: #f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>策略名称 <span style="color: #999; font-size: 11px;">（可选）</span></label>
                        <input type="text" id="sensorStrategyName" placeholder="留空自动生成">
                    </div>
                    <div class="form-group">
                        <label>传感器类型</label>
                        <select id="sensorType">
                            <option value="temperature">🌡️ 温度</option>
                            <option value="humidity">💧 湿度</option>
                            <option value="light">💡 光照</option>
                            <option value="soil_moisture">🌱 土壤湿度</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>传感器节点</label>
                        <input type="number" id="sensorNodeId" value="1" min="1" max="255">
                    </div>
                </div>
                
                <!-- 触发条件区域 -->
                <div style="background: #fafafa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #e67e22;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 10px;">📊 触发条件设置</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>当传感器数值</label>
                            <select id="sensorCondition">
                                <option value="gt">大于 (>) - 超过阈值时触发</option>
                                <option value="lt">小于 (&lt;) - 低于阈值时触发</option>
                                <option value="gte">大于等于 (≥)</option>
                                <option value="lte">小于等于 (≤)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>阈值</label>
                            <input type="number" id="sensorThreshold" value="30" step="0.1">
                            <div style="font-size: 11px; color: #666; margin-top: 4px;">例如：温度30表示30°C</div>
                        </div>
                    </div>
                </div>
                
                <!-- 执行动作区域 -->
                <!-- 隐藏的通道字段，默认值为-1（使用分组绑定的通道） -->
                <input type="hidden" id="sensorChannel" value="-1">
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 10px;">⚡ 执行动作设置</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>控制分组ID <span style="color: #c62828; font-size: 11px;">*必填</span></label>
                            <input type="number" id="sensorGroupId" value="1" min="1">
                            <div style="font-size: 11px; color: #666; margin-top: 4px;">策略将控制该分组绑定的所有通道</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>执行动作</label>
                            <select id="sensorAction">
                                <option value="fwd">▶️ 正转（启动设备）</option>
                                <option value="stop">⏹️ 停止</option>
                                <option value="rev">◀️ 反转</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>冷却时间（秒）</label>
                            <input type="number" id="sensorCooldown" value="60" min="0">
                            <div style="font-size: 11px; color: #666; margin-top: 4px;">触发后多久才能再次触发</div>
                        </div>
                        <div class="form-group">
                            <label>启用</label>
                            <select id="sensorEnabled">
                                <option value="true">✅ 是</option>
                                <option value="false">❌ 否</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="closeModal('sensorStrategyModal')">取消</button>
                <button class="success" onclick="createSensorStrategyAndClose()">➕ 创建策略</button>
            </div>
        </div>
    </div>

    <!-- 简化策略向导弹窗 - 新手友好的创建方式 -->
    <div class="modal-overlay" id="simpleStrategyWizard" onclick="closeModalOnBackground(event, 'simpleStrategyWizard')">
        <div class="modal-content modal-large">
            <div class="modal-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                <h3>✨ 简易策略向导</h3>
                <button class="modal-close" onclick="closeModal('simpleStrategyWizard')">✕</button>
            </div>
            <div class="modal-body">
                <!-- 步骤1：选择策略类型 -->
                <div id="wizardStep1">
                    <h4 style="margin-bottom: 15px; color: #333;">第1步：选择策略类型</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="wizard-option" onclick="selectWizardType('timer')" style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; cursor: pointer; text-align: center; transition: all 0.3s;" id="wizardTypeTimer">
                            <div style="font-size: 36px; margin-bottom: 10px;">⏰</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">定时策略</div>
                            <div style="font-size: 12px; color: #666;">按时间间隔或每天固定时间执行</div>
                        </div>
                        <div class="wizard-option" onclick="selectWizardType('sensor')" style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; cursor: pointer; text-align: center; transition: all 0.3s;" id="wizardTypeSensor">
                            <div style="font-size: 36px; margin-bottom: 10px;">📡</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">传感器策略</div>
                            <div style="font-size: 12px; color: #666;">当传感器数值达到条件时执行</div>
                        </div>
                    </div>
                </div>

                <!-- 步骤2：配置策略（定时） -->
                <div id="wizardStep2Timer" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: #333;">第2步：配置定时策略</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                        <div class="form-group">
                            <label>📝 策略名称 <span style="color: #999; font-size: 12px;">（可选，留空自动生成）</span></label>
                            <input type="text" id="wizardTimerName" placeholder="例如：定时通风">
                        </div>
                        <!-- 隐藏的通道字段，默认值为-1（使用分组绑定的通道） -->
                        <input type="hidden" id="wizardTimerChannel" value="-1">
                        <div class="form-row">
                            <div class="form-group">
                                <label>📂 绑定分组ID</label>
                                <input type="number" id="wizardTimerGroupId" value="1" min="1">
                                <div style="font-size: 11px; color: #666; margin-top: 4px;">策略将控制该分组绑定的所有通道</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>⚡ 执行动作</label>
                                <select id="wizardTimerAction">
                                    <option value="fwd">▶️ 正转（启动）</option>
                                    <option value="stop">⏹️ 停止</option>
                                    <option value="rev">◀️ 反转</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>🔄 触发类型</label>
                                <select id="wizardTimerTriggerType" onchange="toggleWizardTimerTypeInputs()">
                                    <option value="interval">按间隔执行</option>
                                    <option value="daily">每日定时执行</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" id="wizardIntervalInputGroup">
                                <label>⏱️ 执行间隔（秒）</label>
                                <input type="number" id="wizardTimerInterval" value="3600" min="1">
                                <div style="font-size: 11px; color: #666; margin-top: 4px;">3600秒 = 1小时</div>
                            </div>
                            <div class="form-group" id="wizardDailyTimeInputGroup" style="display: none;">
                                <label>📅 每日执行时间</label>
                                <input type="time" id="wizardTimerDailyTime" value="08:00">
                                <div style="font-size: 11px; color: #666; margin-top: 4px;">格式：HH:MM（24小时制）</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 步骤2：配置策略（传感器） -->
                <div id="wizardStep2Sensor" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: #333;">第2步：配置传感器策略</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                        <div class="form-group">
                            <label>📝 策略名称 <span style="color: #999; font-size: 12px;">（可选，留空自动生成）</span></label>
                            <input type="text" id="wizardSensorName" placeholder="例如：高温自动降温">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>🌡️ 传感器类型</label>
                                <select id="wizardSensorType">
                                    <option value="temperature">🌡️ 温度</option>
                                    <option value="humidity">💧 湿度</option>
                                    <option value="light">💡 光照</option>
                                    <option value="soil_moisture">🌱 土壤湿度</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>📍 传感器节点</label>
                                <input type="number" id="wizardSensorNode" value="1" min="1" max="255">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>📊 触发条件</label>
                                <select id="wizardSensorCondition">
                                    <option value="gt">大于 (>) - 超过阈值时触发</option>
                                    <option value="lt">小于 (&lt;) - 低于阈值时触发</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>🎯 阈值</label>
                                <input type="number" id="wizardSensorThreshold" value="30" step="0.1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>📂 控制分组ID</label>
                                <input type="number" id="wizardSensorGroupId" value="1" min="1">
                                <div style="font-size: 11px; color: #666; margin-top: 4px;">策略将控制该分组绑定的所有通道</div>
                            </div>
                            <div class="form-group">
                                <label>⚡ 执行动作</label>
                                <select id="wizardSensorAction">
                                    <option value="fwd">▶️ 正转（启动）</option>
                                    <option value="stop">⏹️ 停止</option>
                                    <option value="rev">◀️ 反转</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="closeModal('simpleStrategyWizard')">取消</button>
                <button class="success" onclick="submitWizardStrategy()" id="wizardSubmitBtn" style="display: none;">✅ 创建策略</button>
            </div>
        </div>
    </div>

    <!-- 引入外部JavaScript -->
    <script src="js/app.js"></script>
    <script src="js/blueprint.js"></script>
</body>
</html>
